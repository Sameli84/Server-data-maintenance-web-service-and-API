<!DOCTYPE html>
<html lang="en" layout:decorate="~{layout}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>[[${course.name}]]</title>
</head>
<body>
<section layout:fragment="content">
    <div th:if="${param.joined}" class="alert alert-success">Joined!</div>
    <div th:if="${param.error}" class="alert alert-danger">ERROR!</div>
    <div th:if="${param.key}" class="alert alert-success">Added a new key!</div>
    <h1>[[${course.name}]]</h1>
    <p>by [[${course.getOwner()?.getName()}]]</p>

    <th:block sec:authorize="hasRole('ROLE_TEACHER')">
        <h3>KEYS</h3>
        <ul class="list-group mb-3">
            <li th:each="key : ${course.getCourseKeys()}" class="list-group-item">
                <span class="col" th:text="${key.getKey()}"></span>
                <form method="post"
                      th:action="@{/courses/{url}/keys/{key}/revoke(url=${course.url},key=${key.getId()})}"
                      sec:authorize="hasRole('ROLE_TEACHER')">
                    <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>
                    <input type="submit" value="Revoke" class="btn btn-danger btn-sm">
                </form>
            </li>
        </ul>
        <form th:action="@{/courses/{url}/keys/create(url=${course.url})}" method="post">
            <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>
            <div class="form-floating mb-3">
                <input type="text" name="key" id="key2-input" class="form-control" placeholder="course key">
                <label for="key2-input">Course key</label>
            </div>
            <input type="submit" value="Add key" class="btn btn-primary mb-3">
        </form>
    </th:block>

    <form method="post" th:action="@{/courses/{url}/join(url=${course.url})}" sec:authorize="hasRole('ROLE_STUDENT')"
          th:if="${!isStudent}" class="mb-3">
        <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>
        <div class="form-floating mb-3" th:if="${hasKey}">
            <input name="key" id="key-input" class="form-control" placeholder="key">
            <label for="key-input">Course key</label>
        </div>
        <input type="submit" value="Join" class="btn btn-primary">
    </form>

    <h3>STUDENTS!</h3>
    <ul class="list-group mb-3">
        <li th:each="student : ${course.getStudents()}" class="list-group-item">
            <span class="col">[[${student.getName()}]]</span>
            <form method="post"
                  th:action="@{/courses/{url}/students/{student}/kick(url=${course.url},student=${student.id})}"
                  sec:authorize="hasRole('ROLE_ADMIN')">
                <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>
                <input type="submit" value="Kick" class="btn btn-danger btn-sm">
            </form>
        </li>
    </ul>

    <th:block th:if="${datarows.size() > 0}">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>student name</th>
                <th>student alias</th>
                <th>csc username</th>
                <th>uid</th>
                <th>dns name</th>
                <th>self made dns name</th>
                <th>name</th>
                <th>vps user name</th>
                <th>pouta dns</th>
                <th>ip address</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="dataRow : ${datarows}">
                <td>[[${dataRow.account.name}]]</td>
                <td>[[${dataRow.studentAlias}]]</td>
                <td>[[${dataRow.cscUsername}]]</td>
                <td>[[${dataRow.uid}]]</td>
                <td>[[${dataRow.dnsName}]]</td>
                <td>[[${dataRow.selfMadeDnsName}]]</td>
                <td>[[${dataRow.name}]]</td>
                <td>[[${dataRow.vpsUserName}]]</td>
                <td>[[${dataRow.poutaDns}]]</td>
                <td>[[${dataRow.ipAddress}]]</td>
            </tr>
            </tbody>
        </table>
    </th:block>

    <td th:text="${error} ?: 'UNKNOWN'"/>

    <p>DATA</p>
    <form method="post" th:action="@{/courses/{url}/students/{id}/update-data(url=${course.url}, id=${user.getId()})}"
          th:if="${isStudent}">
        <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>
        <div class="form-floating mb-3">
            <input type="text" name="studentAlias" id="student-alias-input" th:value="${data?.getStudentAlias()}"
                   placeholder="student alias" class="form-control" required>
            <label for="student-alias-input">student alias</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" name="cscUsername" id="csc-username-input" th:value="${data?.getCscUsername()}"
                   placeholder="student alias" class="form-control" required>
            <label for="csc-username-input">csc username</label>
        </div>
        <div class="form-floating mb-3">
            <input type="number" name="uid" id="uid-input" th:value="${data?.getUid()}" placeholder="55555"
                   class="form-control" required>
            <label for="uid-input">uid</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" name="selfMadeDnsName" id="self-made-dns-name-input"
                   th:value="${data?.getSelfMadeDnsName()}" placeholder="self made dns name" class="form-control"
                   required>
            <label for="self-made-dns-name-input">self made dns name</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" name="vpsUsername" id="vps-user-name-input" th:value="${data?.getVpsUserName()}"
                   placeholder="vps username" class="form-control" required>
            <label for="vps-user-name-input">vps user name</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" name="dnsName" id="dns-name-input" th:value="${data?.getDnsName()}"
                   placeholder="dns name" class="form-control" required>
            <label for="dns-name-input">Dns name</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" name="name" id="name-input" th:value="${data?.getName()}" placeholder="name"
                   class="form-control" required>
            <label for="name-input">Name</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" name="poutaDns" id="pouta-dns-input" th:value="${data?.getPoutaDns()}"
                   placeholder="pouta dns" class="form-control" required>
            <label for="pouta-dns-input">pouta dns</label>
        </div>
        <div class="form-floating mb-3">
            <input type="text" name="ipAddress" id="ip-address-input" th:value="${data?.getIpAddress()}" minlength="7"
                   maxlength="15" size="15" required
                   pattern="^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$"
                   placeholder="255.255.255.255" class="form-control">
            <label for="ip-address-input">ip address</label>
        </div>

        <input type="submit" value="Update information" class="btn btn-primary mb-3">
    </form>
</section>
</body>
</html>